<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Come Mangonio</title>
<style>
  :root{
    --panel-bg:#000;
    --panel-contrast:#111;
    --muted:#8d8d8d;
    --accent:#ffd83b;
  }

  body{
    margin:0;
    background:#000;
    font-family:Arial, sans-serif;
    color:white;
    display:flex;
    justify-content:center;
    padding:20px;
  }

  .wrap{
    width:1100px;
    max-width:100%;
    display:grid;
    grid-template-columns: 1fr 300px;
    gap:20px;
  }

  header{
    grid-column:1/-1;
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:6px;
  }

  header img{
    width:50px;height:50px;
    border-radius:10px;
    object-fit:cover;
  }

  h1{margin:0;font-size:22px}
  .sub{color:var(--muted)}

  canvas{
    display:block;
    width:100%;
    height:auto;
    border-radius:10px;
    background:#000;
  }

  .panel{
    background:var(--panel-bg);
    border-radius:12px;
    padding:14px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .score{
    font-size:32px;
    color:var(--accent);
    font-weight:bold;
  }

  button{
    background:var(--accent);
    border:none;
    padding:8px 10px;
    font-weight:bold;
    border-radius:8px;
    cursor:pointer;
  }

  .instructions{
    background:var(--panel-contrast);
    padding:10px;
    border-radius:10px;
    color:#ccc;
    font-size:14px;
  }

  @media(max-width:900px){
    .wrap{
      grid-template-columns:1fr;
    }
  }
</style>
</head>
<body>

<div class="wrap">

  <header>
    <img src="mangonio.png" onerror="this.style.display='none'">
    <div>
      <h1>Come Mangonio</h1>
      <div class="sub">Versión 60 FPS</div>
    </div>
  </header>

  <canvas id="game" width="900" height="600"></canvas>

  <aside class="panel">
    <div>
      <div style="color:#777;font-size:14px">Puntuación</div>
      <div id="score" class="score">0</div>
    </div>

    <button id="btnRestart">Reiniciar</button>
    <button id="btnPause">Pausa</button>

    <div class="instructions">
      Usa WASD o flechas para moverte.<br>
      Come manzanas para crecer.<br>
      Si chocas el borde o tu cuerpo, pierdes.
    </div>
  </aside>

</div>


<script>

/* ========== CONFIGURACIÓN ========== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// tablero reducido + celdas grandes
const COLS = 23;
const ROWS = 15;
const CELL = 36;

canvas.width = COLS * CELL;
canvas.height = ROWS * CELL;

let snake = [];
let dir = {x:1, y:0};
let nextDir = {x:1, y:0};
let food = null;
let score = 0;
let paused = false;

// colores Snake Google
const c1 = "#76c442";
const c2 = "#6eb73d";

// obtener botones (ARREGLO DEL ERROR)
const btnPause = document.getElementById("btnPause");
const btnRestart = document.getElementById("btnRestart");

// imágenes
const imgHead = new Image();
const imgApple = new Image();
let headOK=false, appleOK=false;

imgHead.src = "mangonio.png";
imgApple.src = "manzana.png";

imgHead.onload = ()=> headOK=true;
imgApple.onload = ()=> appleOK=true;


/* ========== INICIO ========== */
function resetGame(){
  snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
  dir = {x:1,y:0};
  nextDir = {x:1,y:0};
  spawnFood();
  score = 0;
  document.getElementById("score").innerText = score;
}
resetGame();


/* ========== COMIDA ========== */
function spawnFood(){
  while(true){
    const x = Math.floor(Math.random()*COLS);
    const y = Math.floor(Math.random()*ROWS);
    if(!snake.some(s=>s.x===x && s.y===y)){
      food = {x,y};
      return;
    }
  }
}


/* ========== INPUT ========== */
window.addEventListener("keydown", e=>{
  if(e.code==="ArrowUp"||e.code==="KeyW") nextDir={x:0,y:-1};
  if(e.code==="ArrowDown"||e.code==="KeyS") nextDir={x:0,y:1};
  if(e.code==="ArrowLeft"||e.code==="KeyA") nextDir={x:-1,y:0};
  if(e.code==="ArrowRight"||e.code==="KeyD") nextDir={x:1,y:0};
  if(e.code==="Space") paused = !paused;
});

btnRestart.onclick = ()=> resetGame();
btnPause.onclick = ()=>{
  paused = !paused;
  btnPause.innerText = paused ? "Reanudar" : "Pausa";
};


/* ========== UPDATE 60 FPS ========== */
function update(){
  if(paused) return;

  if(Math.abs(nextDir.x) !== Math.abs(dir.x) || Math.abs(nextDir.y) !== Math.abs(dir.y))
    dir = nextDir;

  const head = snake[0];
  const nx = head.x + dir.x;
  const ny = head.y + dir.y;

  if(nx<0 || nx>=COLS || ny<0 || ny>=ROWS){
    resetGame(); return;
  }

  if(snake.some((s,i)=>i>0 && s.x===nx && s.y===ny)){
    resetGame(); return;
  }

  snake.unshift({x:nx, y:ny});

  if(nx===food.x && ny===food.y){
    score+=10;
    document.getElementById("score").innerText = score;
    spawnFood();
  } else {
    snake.pop();
  }
}


/* ========== DRAW ========== */
function draw(){
  for(let x=0;x<COLS;x++){
    for(let y=0;y<ROWS;y++){
      ctx.fillStyle = ((x+y)%2===0)?c1:c2;
      ctx.fillRect(x*CELL, y*CELL, CELL, CELL);
    }
  }

  // apple
  if(appleOK){
    ctx.drawImage(imgApple, food.x*CELL, food.y*CELL, CELL, CELL);
  } else {
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(food.x*CELL+CELL/2, food.y*CELL+CELL/2, CELL*0.4, 0, Math.PI*2);
    ctx.fill();
  }

  // body
  ctx.fillStyle="#ffd652";
  for(let i=1;i<snake.length;i++){
    ctx.fillRect(snake[i].x*CELL+4, snake[i].y*CELL+4, CELL-8, CELL-8);
  }

  // head
  const h = snake[0];
  if(headOK){
    ctx.drawImage(imgHead, h.x*CELL, h.y*CELL, CELL, CELL);
  } else {
    ctx.fillStyle="#0a8a0a";
    ctx.fillRect(h.x*CELL+3, h.y*CELL+3, CELL-6, CELL-6);
  }
}


/* ========== LOOP 60FPS ========== */
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

</script>

</body>
</html>
