<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Come Mangonio</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#0b1220;
      --accent:#ff6b6b;
      --accent-2:#ffd166;
      --snake:#4ce0b3;
      --food:#ff6b6b;
      --muted:#9aa4b2;
    }

    html,body{
      height:100%;
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial
    }

    /* FONDO BLANCO */
    body{
      background:#ffffff;
      display:flex;
      align-items:center;
      justify-content:center;
      color:#000000;
    }

    .wrap{
      width:980px;
      max-width:96vw;
      background:linear-gradient(180deg,rgba(0,0,0,0.02),rgba(0,0,0,0.02));
      border-radius:14px;
      padding:18px;
      box-shadow:0 8px 30px rgba(0,0,0,0.2);
      display:grid;
      grid-template-columns:1fr 320px;
      gap:18px;
    }

    header{
      grid-column:1/-1;
      display:flex;
      align-items:center;
      gap:12px;
    }

    h1{ margin:0; font-size:20px }
    .sub{ color:var(--muted); font-size:13px }

    /* CANVAS VERDE PASTO */
    canvas{
      background:#3da63d;
      border-radius:0px;
      display:block;
      width:100%;
      height:auto;
      image-rendering:pixelated;
    }

    /* PANEL */
    .panel{
      background:#111;
      border-radius:10px;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
      color:#eee;
    }

    .score{ font-size:28px; font-weight:700; color:var(--accent-2) }
    .controls{ display:flex; gap:8px; flex-wrap:wrap }

    button{
      background:rgba(255,255,255,0.05);
      border:1px solid rgba(255,255,255,0.08);
      padding:8px 10px;
      border-radius:8px;
      color:inherit;
      cursor:pointer;
    }

    .muted{ color:var(--muted); font-size:13px }
    .footer{ font-size:12px; color:var(--muted) }
    .big{ font-size:18px }
    .hint{ background:rgba(255,255,255,0.05); padding:8px; border-radius:8px }

    @media (max-width:860px){
      .wrap{ grid-template-columns:1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <img src="Mangonio.png" alt="Mangonio"
        style="width:48px;height:48px;border-radius:8px;object-fit:cover;
        filter:drop-shadow(0 6px 18px rgba(0,0,0,0.6))"
        onerror="this.style.display='none'"
      />
      <div>
        <h1>Come Mangonio</h1>
        <div class="sub">Un juego estilo Snake — juega como el gusano <strong>Mangonio</strong></div>
      </div>
    </header>

    <main>
      <canvas id="game" width="640" height="480"></canvas>
    </main>

    <aside class="panel">
      <div>
        <div class="muted">Puntuación</div>
        <div id="score" class="score">0</div>
        <div class="muted">Velocidad</div>
        <div id="speedLabel" class="big">Normal</div>
      </div>

      <div>
        <div class="muted">Controles</div>
        <div class="controls">
          <button id="btnUp">↑</button>
          <button id="btnLeft">←</button>
          <button id="btnDown">↓</button>
          <button id="btnRight">→</button>
          <button id="btnPause">Pausa</button>
          <button id="btnRestart">Reiniciar</button>
        </div>
      </div>

      <div class="hint">
        <div class="muted">Cómo jugar</div>
        <div class="muted">Muévete con las flechas o WASD. Come la comida para crecer. Evita chocar contra ti mismo y los muros (opcional).</div>
      </div>

      <div class="footer">Hecho para GitHub — coloca <code>Mangonio.png</code> en la misma carpeta.</div>
    </aside>
  </div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const GRID_SIZE = 20;
  const COLS = Math.floor(canvas.width / GRID_SIZE);
  const ROWS = Math.floor(canvas.height / GRID_SIZE);

  let snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
  let dir = {x: 1, y: 0};
  let nextDir = {x:1,y:0};
  let food = null;
  let score = 0;
  let tickMs = 16;
  let running = true;
  let wallsKill = false;

  let imgMangonio = new Image();
  let imgReady = false;
  imgMangonio.src = 'Mangonio.png';
  imgMangonio.onload = () => imgReady = true;
  imgMangonio.onerror = () => imgReady = false;

  const scoreEl = document.getElementById('score');
  const speedLabel = document.getElementById('speedLabel');

  function randEmptyCell(){
    while(true){
      const x = Math.floor(Math.random()*COLS);
      const y = Math.floor(Math.random()*ROWS);
      if(!snake.some(s=>s.x===x && s.y===y)) return {x,y};
    }
  }

  function placeFood(){ food = randEmptyCell(); }
  placeFood();

  function setSpeed(ms){
    tickMs = ms;
    if(ms<80) speedLabel.textContent='Rápido';
    else if(ms<140) speedLabel.textContent='Normal';
    else speedLabel.textContent='Lento';
  }
  setSpeed(120);

  function reset(){
    snake = [{x: Math.floor(COLS/2), y: Math.floor(ROWS/2)}];
    dir = {x:1,y:0};
    nextDir={x:1,y:0};
    score=0;
    scoreEl.textContent = score;
    placeFood();
    running=true;
    setSpeed(120);
  }

  function step(){
    if(!running) return;

    if(Math.abs(nextDir.x) !== Math.abs(dir.x) || Math.abs(nextDir.y) !== Math.abs(dir.y))
      dir = nextDir;

    const head = {x: snake[0].x + dir.x, y: snake[0].y + dir.y};

    if(wallsKill){
      if(head.x < 0 || head.x >= COLS || head.y < 0 || head.y >= ROWS){
        gameOver();
        return;
      }
    } else {
      head.x = (head.x + COLS) % COLS;
      head.y = (head.y + ROWS) % ROWS;
    }

    if(snake.some((s,idx)=>idx>0 && s.x===head.x && s.y===head.y)){
      gameOver();
      return;
    }

    snake.unshift(head);

    if(food && head.x===food.x && head.y===food.y){
      score+=10;
      scoreEl.textContent = score;
      placeFood();
      if(score % 50 === 0) setSpeed(Math.max(60, tickMs - 10));
    } else {
      snake.pop();
    }
  }

  function gameOver(){
    running=false;
    setTimeout(()=>alert("¡Game Over! Pulsa Reiniciar"), 50);
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // comida
    if(food){
      ctx.fillStyle = '#ff6b6b';
      ctx.fillRect(food.x*GRID_SIZE+4, food.y*GRID_SIZE+4, GRID_SIZE-8, GRID_SIZE-8);
    }

    // snake
    for(let i=0;i<snake.length;i++){
      const s = snake[i];
      const px = s.x*GRID_SIZE;
      const py = s.y*GRID_SIZE;

      if(imgReady){
        ctx.drawImage(imgMangonio, px, py, GRID_SIZE, GRID_SIZE);
      } else {
        ctx.fillStyle = "#0a0";
        ctx.fillRect(px, py, GRID_SIZE, GRID_SIZE);
      }
    }
  }

  window.addEventListener('keydown', e=>{
    if(['ArrowUp','KeyW'].includes(e.code)) nextDir = {x:0,y:-1};
    if(['ArrowDown','KeyS'].includes(e.code)) nextDir = {x:0,y:1};
    if(['ArrowLeft','KeyA'].includes(e.code)) nextDir = {x:-1,y:0};
    if(['ArrowRight','KeyD'].includes(e.code)) nextDir = {x:1,y:0};
    if(e.code==='KeyP') running = !running;
  });

  document.getElementById('btnUp').addEventListener('click', ()=> nextDir={x:0,y:-1});
  document.getElementById('btnDown').addEventListener('click', ()=> nextDir={x:0,y:1});
  document.getElementById('btnLeft').addEventListener('click', ()=> nextDir={x:-1,y:0});
  document.getElementById('btnRight').addEventListener('click', ()=> nextDir={x:1,y:0});
  document.getElementById('btnPause').addEventListener('click', ()=> running = !running);
  document.getElementById('btnRestart').addEventListener('click', ()=> reset());

  let last = performance.now();
  let accumulator = 0;

  function loop(now){
    const dt = now - last;
    last = now;
    accumulator += dt;

    while(accumulator >= tickMs){
      step();
      accumulator -= tickMs;
    }

    draw();
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
})();
</script>

</body>
</html>
